<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <title>REPL</title>

    <link rel="icon" type="image/png" href="favicon.png" />
    <link rel="stylesheet" href="https://pyscript.net/alpha/pyscript.css" />
    <script defer src="https://pyscript.net/alpha/pyscript.js"></script>

    <style>
      select {
        font-size: .9rem;
        padding: 2px 5px;
      }
    </style>

    <py-env>
        - numpy
        - matplotlib
        - seaborn
        - scipy
        - absl-py
        - paths:
            - /fetch_data.py
            - /plot_data.py
    </py-env>
    <py-repl></py-repl>
  </head>

  <body>
    Hello world! <br>

    <fieldset>
        <legend>Agents</legend>
        <div>
          <input type="checkbox" id="der" name="agent" value="der">
          <label for="der">DER</label>
        </div>
        <div>
          <input type="checkbox" id="drq_eps" name="agent" value="drq_eps">
          <label for="drq_eps">DrQ</label>
        </div>
      </fieldset>

      <select name="experiments" id="exp-select">
        <option value="convs_normalization">Convs Normalization</option>
        <option value="batch_sizes">Batch Sizes</option>
        <option value="convs">Number of Convolutions</option>
        <option value="depths">Number of Dense Layers</option>
        <option value="spider">Spider</option>
        <option value="goldfish">Goldfish</option>
        <option value="clip_rewards">Reward Clipping</option>
    </select>

    <div id="DER"></div>
    <div id="DrQ_eps"></div>
    <py-script>

        from functools import partial
        import pickle
        import asyncio

        import matplotlib.pyplot as plt
        import numpy as np
        
        import js
        from pyodide import create_proxy
        from fetch_data import fetch_data, experiments_mapping
        from plot_data import plot_score_hist

        def on_select(agent, experiment, event):
            agent_checkbox = js.document.body.querySelector(f'#{agent.lower()}')
            if agent_checkbox.checked:
                fig = plot_score_hist(data[f'{agent}_{experiment}'], bins=4, N=6, figsize=(28, 11))
                fig.subplots_adjust(hspace=0.85, wspace=0.17)
                pyscript.write(agent, fig)
            else:
                pyscript.write(agent, "")

        exp_selector = js.document.body.querySelector('#exp-select')
        exp = experiments_mapping[exp_selector.selectedIndex]
        await fetch_data('convs_normalization')

        with open('file.pickle', mode='rb') as f:
            data = pickle.load(f)
        <!-- y = data['DER_normalizations_convs']['DER_normalizations_convs_non_normalization']   -->
        plot_der = js.document.body.querySelector('#der')
        plot_der.addEventListener('change', create_proxy(partial(on_select, "DER", "normalizations_convs")))

        plot_drq = js.document.body.querySelector('#drq_eps')
        plot_drq.addEventListener('change', create_proxy(partial(on_select, "DrQ_eps", "normalizations_convs")))

    </py-script>
  </body>
</html>